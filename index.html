<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Bootstrap 101 Template</title>
    <!-- Bootstrap -->
    <style>
        body {
            position: absolute;
            left: 0;
            right: 0;
            width: auto;
            height: auto;
        }

        .view-border {
            padding: 5px;
        }
    </style>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>

    <div class="col-sm-6 container-form">
        <h1>AJAX LAB</h1>
        <h2>Add Authors</h2>
        <form id="authorForm">
            <div class="form-group">
                <label>ID</label>
                <input type="text" class="form-control" id="idInput" placeholder="ID" />
            </div>
            <div class="form-group">
                <label>First Name</label>
                <input type="text" class="form-control" id="firstName" placeholder="First Name" />
            </div>
            <div class="form-group">
                <label>Last Name</label>
                <input type="text" class="form-control" id="lastName" placeholder="Last Name" />
            </div>
            <div class="form-group">
                <label>Age</label>
                <input type="text" class="form-control" id="age" placeholder="Age" />
            </div>
            <div class="form-group">
                <label>Salary</label>
                <input type="text" class="form-control" id="salary" placeholder="Salary" />
            </div>
            <button type="submit" id="postAuthor" class="btn btn-primary" style="position: relative; left: 20%; top: 20px;">POST</button>

            <button type="submit" id="putAuthor" class="btn btn-primary" style="position: relative; left: 30%; top: 20px;">PUT</button>

            <button type="submit" id="deleteAuthor" class="btn btn-primary" style="position: relative; left: 40%; top: 20px;">DELETE</button>


        </form>
        <div id="authorContainer" style="position: relative; top: 200px;">
        </div>
    </div>

    <div class="col-sm-6 authorList" style="top: 70px;">
        <button type="submit" id="showAuthorsButton" style="left: 15%; position: relative;" class="btn btn-primary">SHOW ALL AUTHORS</button>
        <button type="submit" id="showIDAuthors" style="left: 30%; position: relative;" class="btn btn-primary">SHOW AUTHOR BY ID</button>
    </div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <script src="sabio.js"></script>
    <!-- All your code goes below here-->

    <script type="text/template" id="authorTemplate">
        <div class="viewAuthor col-md-6 view-border">
            <h3 class="authorName">Name: <span class="part1"></span> <span class="part2"></span></h3>
            <h4 class="authorAge">Age: <span></span></h4>
            <h4 class="authorSalary">Salary: <span></span></h4>
            <h4 class="articleNumber">Articles: <span></span></h4>
        </div>
    </script>

    <script type="text/html" id="authorTemplate2">

        <div class="viewAuthor row listing-row view-border">
            <h3 class="authorName">Name: <span style="position: relative; left: 20px;" class="part1"></span> <span style="position: relative; left: 40px;" class="part2"></span></h3>
            <button type="submit" class="btn btn-danger pull-right deleteAuthorButton" style="position: relative; top: -40px;">Delete</button>
            <input type="checkbox" style=" position: relative; margin-right: 55px; height: 30px; width: 30px; top: -40px;" class="checkerBox pull-right" />
        </div>

    </script>

    <script type="text/javascript">

        sabio.page.startUp = function () {
            console.log("page has loaded");
            $.ajaxSetup({
                headers: { 'SABIO-AUTH': 'U4U158XKP' }
            });
            $("#showAuthorsButton").on("click", sabio.page.handlers.showAuthors); //On click goes to showAuthors() [1]
            $("#showIDAuthors").on("click", sabio.page.handlers.showIDAuthor); //On click goes to showIDAuthor() [2]
            $("#postAuthor").on("click", sabio.page.handlers.postAuthor); //On click goes to postAuthor() [3]
            $("#putAuthor").on("click", sabio.page.handlers.putAuthor); //On click goes to putAuthor() [4]
            $("#deleteAuthor").on("click", sabio.page.handlers.deleteAuthor); //On click goes to deleteAuthor() [5]
        }

         /*----------------------------ALL GLOBAL FUNCTIONS AT BOTTOM.--------------------------*/

        /*=============================[[SHOW ALL AUTHORS BUTTON]]=============================*/
                                             /*[1]*/
        sabio.page.handlers.showAuthors = function () {
            sabio.page.getAllAuthors(sabio.page.ajaxSuccess, sabio.page.ajaxError);
        }

        
        sabio.page.getAllAuthors = function (onSuccess, onError) {
            var url = "https://sabioapi2.azurewebsites.net/api/authors";

            var settings = {
                cache: false
                , contentType: "application/x-www-form-urlencoded; charset=UTF-8"
                , dataType: "json"
                , success: onSuccess
                , error: onError
                , type: "GET"
            };
            $.ajax(url, settings);
        };
        
        sabio.page.authorLoop = function (authorArray) {
            for (var i = 0; i < authorArray.length; i++) {
                sabio.page.writeToTemplate(authorArray[i]);
            }
        }

        sabio.page.writeToTemplate = function (data) {
            var authorTemplate = sabio.page.loadTemplate();
            authorTemplate.find(".authorName .part1").text(data.firstName);
            authorTemplate.find(".authorName .part2").text(data.lastName);
            authorTemplate.find(".authorAge > span").text(data.age);
            authorTemplate.find(".authorSalary > span").text(data.salary);
            if (data.articles == null) {
                data.articles = "No articles found";
            }
            authorTemplate.find(".articleNumber > span").text(data.articles);
            $(".authorList").append(authorTemplate);
        }
        /*============================[[SHOW ID AUTHOR BUTTON]]==============================*/
                                               /*[2]*/
        sabio.page.handlers.showIDAuthor = function () {
            var idGetter = $("#idInput").val();
            if (idGetter != "") {
                sabio.page.getOneAuthor(sabio.page.ajaxSuccessID, sabio.page.ajaxError);
            } else {
                alert("Please Enter Valid ID");
            }
        }

        sabio.page.getOneAuthor = function (onSuccess, onError) {
            var idGetter = $("#idInput").val();
            console.log(idGetter);
            var url = "https://sabioapi2.azurewebsites.net/api/authors/" + idGetter;

            var settings = {
                cache: false
                , contentType: "application/x-www-form-urlencoded; charset=UTF-8"
                , dataType: "json"
                , success: onSuccess
                , error: onError
                , type: "GET"
            };
            $.ajax(url, settings);
        };

        sabio.page.writeToTemplateID = function (data) {
            var authorTemplate = sabio.page.loadTemplate();
            authorTemplate.find(".authorName .part1").text(data.item.firstName);
            authorTemplate.find(".authorName .part2").text(data.item.lastName);
            authorTemplate.find(".authorAge > span").text(data.item.age);
            authorTemplate.find(".authorSalary > span").text(data.item.salary);
            if (data.articles == null) {
                data.articles = "No articles found";
            }
            authorTemplate.find(".articleNumber > span").text(data.articles);
            $(".authorList").append(authorTemplate);
        }
        /*============================[[POST AUTHOR BUTTON]]==============================*/
                                            /*[3]*/
        sabio.page.handlers.postAuthor = function (event) {
            event.preventDefault();
            var authorData = sabio.page.readForm();
            if (authorData.firstName == "") {
                alert("Please Enter a First Name");
            } else if (authorData.lastName == "") {
                alert("Please Enter a Second Name");
            } else if (authorData.age == "") {
                alert("Please Enter an Age");
            } else if (authorData.salary == "") {
                alert("Please Enter a Salary");
            } else {
                sabio.page.postAppendAuthor(authorData);
                sabio.page.clearForm();
            }
        }
        
        sabio.page.postAppendAuthor = function (data) {
            var authorTemplate;
            if (sabio.page.savedAuthorId == null) {
                authorTemplate = sabio.page.loadTemplate2();
            } else {
                authorTemplate = $("#" + sabio.page.savedAuthorId);
            };
            authorTemplate.find(".authorName .part1").text(data.firstName);
            authorTemplate.find(".authorName .part2").text(data.lastName);
            authorTemplate.find(".authorAge span").text(data.age);
            authorTemplate.find(".authorSalary span").text(data.salary);
            authorTemplate.find(".checkerBox").hide();
            authorTemplate.attr("id", Math.floor(Math.random() * 10000));
            $(".authorList").append(authorTemplate);
            $("#postAuthor").text("POST");
            sabio.page.addAuthor(data, sabio.page.ajaxSuccessPOST, sabio.page.ajaxError);
            sabio.page.savedAuthorId = null;
        };

        sabio.page.addAuthor = function (data, onSuccess, onError) {
            var url = "https://sabioapi2.azurewebsites.net/api/authors";
            var settings = {
                cache: false
                , contentType: "application/x-www-form-urlencoded; charset=UTF-8"
                , data: data
                , dataType: "json"
                , success: onSuccess
                , error: onError
                , type: "POST"
            };
            $.ajax(url, settings);
        };

        sabio.page.readForm = function () {
            var firstName = $("#firstName").val();
            var lastName = $("#lastName").val();
            var age = $("#age").val();
            var salary = $("#salary").val();
            var authorData = {
                firstName: firstName
                , lastName: lastName
                , age: age
                , salary: salary
            };
            return authorData;
        }
        /*============================[[PUT AUTHOR BUTTON]]==============================*/
                                            /*[4]*/
        sabio.page.handlers.putAuthor = function (event) {
            event.preventDefault();
            var authorData = sabio.page.readFormPD();
            if (authorData.id == "") {
                alert("Please Enter an ID");
            }else if (authorData.firstName == "") {
                alert("Please Enter a First Name");
            } else if (authorData.lastName == "") {
                alert("Please Enter a Second Name");
            } else if (authorData.age == "") {
                alert("Please Enter an Age");
            } else if (authorData.salary == "") {
                alert("Please Enter a Salary");
            } else {
                sabio.page.putAppendAuthor(authorData);
                sabio.page.clearForm();
            }
        }

        sabio.page.putAppendAuthor = function (data) {
            var authorTemplate;
            if (sabio.page.savedAuthorId == null) {
                authorTemplate = sabio.page.loadTemplate2();
            } else {
                authorTemplate = $("#" + sabio.page.savedAuthorId);
            };
            console.log("This works too!");
            authorTemplate.find(".authorName .part1").text(data.firstName);
            authorTemplate.find(".authorName .part2").text(data.lastName);
            authorTemplate.find(".authorAge span").text(data.age);
            authorTemplate.find(".authorSalary span").text(data.salary);
            authorTemplate.find(".checkerBox").hide();
            authorTemplate.attr("id", Math.floor(Math.random() * 10000));
            $(".authorList").append(authorTemplate);
            $("#putAuthor").text("PUT");
            sabio.page.putAuthor(data, sabio.page.ajaxSuccessPOST, sabio.page.ajaxError);
            sabio.page.savedAuthorId = null;
        };

        sabio.page.putAuthor = function (data, onSuccess, onError) {
            var idGetter = $("#idInput").val();
            var url = "https://sabioapi2.azurewebsites.net/api/authors/" + idGetter;
            var settings = {
                cache: false
                , contentType: "application/x-www-form-urlencoded; charset=UTF-8"
                , data: data
                , dataType: "json"
                , success: onSuccess
                , error: onError
                , type: "PUT"
            };
            $.ajax(url, settings);
        };
        /*============================[[DELETE AUTHOR BUTTON]]==============================*/
                                            /*[5]*/
        sabio.page.handlers.deleteAuthor = function (event) {
            event.preventDefault();
            var authorData = sabio.page.readFormPD();
            if (authorData.id == "") {
                alert("Please Enter an ID");
            } else {
                sabio.page.deleteAppendAuthor(authorData);
                sabio.page.clearForm();
            }
        }

        sabio.page.deleteAppendAuthor = function (data) {
            var authorTemplate;
            if (sabio.page.savedAuthorId == null) {
                authorTemplate = sabio.page.loadTemplate2();
            } else {
                authorTemplate = $("#" + sabio.page.savedAuthorId);
            };
            console.log("This works too!");
            authorTemplate.find(".authorName .part1").text(data.firstName);
            authorTemplate.find(".authorName .part2").text(data.lastName);
            authorTemplate.find(".authorAge span").text(data.age);
            authorTemplate.find(".authorSalary span").text(data.salary);
            authorTemplate.find(".checkerBox").hide();
            authorTemplate.attr("id", Math.floor(Math.random() * 10000));
            $(".authorList").append(authorTemplate);
            $("#deleteAuthor").text("DELETE");
            sabio.page.deleteAuthor(data, sabio.page.ajaxSuccessPOST, sabio.page.ajaxError);
            sabio.page.savedAuthorId = null;
        };

        sabio.page.deleteAuthor = function (data, onSuccess, onError) {
            var idGetter = $("#idInput").val();
            var url = "https://sabioapi2.azurewebsites.net/api/authors/" + idGetter;
            var settings = {
                cache: false
                , contentType: "application/x-www-form-urlencoded; charset=UTF-8"
                , data: data
                , dataType: "json"
                , success: onSuccess
                , error: onError
                , type: "DELETE"
            };
            $.ajax(url, settings);
        };
        /*==================OTHER GLOBAL FUNCTIONS=================*/

        sabio.page.clearForm = function () {
            $("#authorForm")[0].reset();
        };

        sabio.page.loadTemplate = function () {
            var $author = $($("#authorTemplate").html());
            return $author;
        }

        sabio.page.loadTemplate2 = function () {
            var template = $($("#authorTemplate2").html());
            return template;
        };

        sabio.page.readFormPD = function () {
            var iD = $("#idInput").val();
            var firstName = $("#firstName").val();
            var lastName = $("#lastName").val();
            var age = $("#age").val();
            var salary = $("#salary").val();
            var authorData = {
                id: iD
                , firstName: firstName
                , lastName: lastName
                , age: age
                , salary: salary
            };
            return authorData;
        }
        /*===================GLOBAL onSuccess() & onError() FUNCTIONS====================*/
                        /*General Success*/
        sabio.page.ajaxSuccess = function (data, status, xhr) {
            console.log("ajax successful");
            console.log(data);
            sabio.page.authorLoop(data.items); //
        };
                       /*ID Success*/
        sabio.page.ajaxSuccessID = function (data, status, xhr) {
            console.log("ajax successful");
            console.log(data);
            sabio.page.writeToTemplateID(data);
        };
                      /*POST Success*/
        sabio.page.ajaxSuccessPOST = function (data, status, xhr) {
            console.log("ajax successful");
            console.log(data); //
        };

        sabio.page.ajaxError = function (data, status, xhr) {
            console.log("there was an error");
            console.log(data.responseText);
        }
    </script>
</body>
</html>
